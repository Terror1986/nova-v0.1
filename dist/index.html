<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>InsightGen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Your CSS -->
  <link rel="stylesheet" href="/assets/vars.css">
  <link rel="stylesheet" href="/assets/style.css">
</head>
<body>

  <!-- Hero, features, signupForm -->
  <section style="background:#2A9D8F;color:#fff;padding:2rem;text-align:center">
  <h1>InsightGen AI</h1><p>Data to Decisions</p>
  <button style="background:#fff;color:#2A9D8F">Get Started</button>
</section>
  <section style="padding:2rem">
  <h2>Features</h2>
  <ul>
      <li>
        <strong>Real-Time</strong>: Live dashboards
      </li>
      <li>
        <strong>Predictive</strong>: Forecast trends
      </li>
      <li>
        <strong>Alerts</strong>: Be the first to know
      </li>
  </ul>
</section>
  <section style="padding:2rem;background:#f4f4f4">
  <h2>Sign up</h2><form>
    <label>email:</label><input name="email" /><br>
    <button type="submit">Submit</button>
  </form>
</section>

  <!-- Nova Chat + Build Widget -->
  <section id="nova-chat" style="
      position: fixed; bottom: 1rem; right: 1rem;
      width: 320px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      border-radius: 8px; background: white; overflow: hidden;
      font-family: sans-serif; z-index: 1000;
    ">
    <div id="nova-chat-messages" style="
        height: 200px; overflow-y: auto;
        padding: 0.5rem; background: #f9f9f9;
      "></div>

    <div style="border-top:1px solid #ddd; display:flex;">
      <input id="nova-chat-input" type="text" placeholder="Say something…"
             style="flex:1;border:none;padding:0.5rem;outline:none"/>
      <button id="nova-chat-send"
              style="border:none;background:var(--primary);color:#fff;padding:0 1rem;cursor:pointer">
        Send
      </button>
      <button id="nova-build-site"
              style="border:none;background:#444;color:#fff;padding:0 1rem;cursor:pointer">
        Build
      </button>
    </div>
    <div id="nova-build-result" style="padding:0.5rem;font-size:0.9rem;"></div>
  </section>

  <script>
  (function(){
    const msgs    = document.getElementById('nova-chat-messages');
    const input   = document.getElementById('nova-chat-input');
    const sendBtn = document.getElementById('nova-chat-send');
    const buildBtn= document.getElementById('nova-build-site');
    const result  = document.getElementById('nova-build-result');

    let sessionId = localStorage.getItem('nova_session') || null;

    function appendBubble(role, text){
      const d = document.createElement('div');
      d.textContent = text;
      d.style.margin = '4px 0';
      d.style.padding= '6px 12px';
      d.style.borderRadius = '12px';
      d.style.display = 'inline-block';
      d.style.maxWidth = '80%';
      d.style.clear = 'both';
      if(role==='user'){
        d.style.background = 'var(--primary)';
        d.style.color = '#fff';
        d.style.float = 'right';
      } else {
        d.style.background = '#eee';
        d.style.color = '#000';
        d.style.float = 'left';
      }
      msgs.appendChild(d);
      msgs.scrollTop = msgs.scrollHeight;
      return d;
    }

    async function sendMsg(text){
      if(!text.trim()) return;
      appendBubble('user', text);
      input.value = '';

      const typing = appendBubble('assistant', 'Nova is typing…');

      try {
        const resp = await fetch('/api/chat',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ session_id: sessionId, message: text })
        });
        const js = await resp.json();
        if(js.reply){
          sessionId = js.session_id;
          localStorage.setItem('nova_session', sessionId);
          typing.textContent = js.reply;
        } else {
          typing.textContent = 'Error: ' + (js.error||'No reply');
        }
      } catch(err) {
        typing.textContent = 'Error: ' + err.message;
      }
    }

    async function buildSite(){
      result.textContent = 'Building…';
      try {
        const r = await fetch('/api/build',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ prompt: input.value || 'Build me a site' })
        });
        const js = await r.json();
        if(js.success){
          result.innerHTML = `<a href="${js.preview}" target="_blank">View Preview</a>`;
        } else {
          throw new Error(js.error||'Unknown');
        }
      } catch(err){
        result.textContent = 'Build failed: '+err.message;
      }
    }

    sendBtn.onclick   = () => sendMsg(input.value);
    input.onkeydown   = e => { if(e.key==='Enter') sendMsg(input.value); };
    buildBtn.onclick  = buildSite;
  })();
  </script>

</body>
</html>